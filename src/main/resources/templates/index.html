<!DOCTYPE html>
<html>

<head>
	<title>Dashboard de investimentos</title>
	<meta charset="utf-8">
	<style>
		table {
			border-collapse: collapse;
			width: 100%;
			max-width: 800px;
		}

		th,
		td {
			padding: 12px;
			text-align: left;
			border-bottom: 1px solid #ddd;
		}

		th {
			background-color: #f2f2f2;
			font-weight: bold;
			white-space: nowrap;
			width: auto;
		}
	</style>
</head>

<body>
	<script>
		function comprar(event) {
			event.preventDefault();
			const acao = document.getElementById('acao').value;
			const compraVenda = document.getElementById('compraVenda').value;
			const qtdAcoes = document.getElementById('qtdAcoes').value;
			const precoAcao = document.getElementById('precoAcao').value;
			const dataMovimento = document.getElementById('dataMovimento').value;
			const compra = {
				acao: acao,
				compraVenda: compraVenda,
				qtdAcoes: qtdAcoes,
				precoAcao: precoAcao,
				dataMovimento: dataMovimento
			};
			if (compra.acao !== "") {
				fetch('http://localhost:8080/api/v1/movimento-acoes/comprar', {
				method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify(compra)
			})
				.then(response => {
					return response.json();
				})
				.then(data => {
					alert(data.mensagem);
				})
				.catch(error => {
					alert('Ocorreu um erro:', error.json().mensagem);
				});
			} else {
				alert("Por favor selecionar a ação que deseja comprar");
			}
			
		}
		
		function ganharDividendo(event) {
			event.preventDefault();
			const acaoDividendo = document.getElementById('acaoDividendo').value;
			const valorRecebido = document.getElementById('valorRecebido').value;
			const dataDividendo = document.getElementById('dataDividendo').value;
			const dividendo = {
				acaoDividendo: acaoDividendo,
				valorRecebido: valorRecebido,
				dataDividendo: dataDividendo
			};
			if (dividendo.acaoDividendo !== "") {
				fetch('http://localhost:8080/api/v1/dividendo-acoes/ganhar', {
				method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify(dividendo)
			})
				.then(response => {
					return response.json();
				})
				.then(data => {
					alert(data.mensagem);
				})
				.catch(error => {
					alert('Ocorreu um erro:', error.json().mensagem);
				});
			} else {
				alert("Por favor selecionar a ação que deseja comprar");
			}
			
		}
	</script>

	<h1>Dashboard de Investimentos</h1>
	<table>
		<tbody>
			<tr>
			<td>
				<h2>Adicionar uma compra/venda:</h2>
				<form onsubmit="comprar(event)">
					<div>
						<label for="seletorAcao">Ação:</label>
						<select id="acao">
							<option value="">SELECIONAR</option>
							<option th:each="acaoFundamentus : ${acoesDisponiveis}" 
							th:value="${acaoFundamentus}" 
							th:text="${acaoFundamentus}"></option>
						</select>
					</div>
					<div>
						<label for="compraVenda">Lado da operação:</label>
						<select id="compraVenda">
							<option value="COMPRAR">Comprar</option>
							<option value="VENDER">Venda</option> 
						</select>
					</div>
					<br>
					<div>
						<label for="qtdAcoes">Quantidade de ações:</label>
						<input required type="number" id="qtdAcoes" />
					</div>
					<br>
					<div>
						<label for="precoAcao">Valor pago por ação (R$):</label>
						<input required type="text" id="precoAcao" />
					</div>
					<br>
					<div>
						<label for="dataMovimento">Data da movimentação:</label>
						<input type="date" id="dataMovimento" />
					</div>
					<br>
					<div class="button">
						<button type="submit">Submeter compra</button>
					</div>
				</form>
			</td>
			<td>
				<h2>Adicionar dividendo/JCP:</h2>
				<form onsubmit="ganharDividendo(event)">
					<div>
						<label for="seletorAcaoDividendo">Ação:</label>
						<select id="acaoDividendo">
							<option value="">SELECIONAR</option>
							<option th:each="acaoFundamentus : ${acoesDisponiveis}" 
							th:value="${acaoFundamentus}" 
							th:text="${acaoFundamentus}"></option>
						</select>
					</div>
					<br>
					<div>
						<label for="valorRecebido">Dividendo total (R$):</label>
						<input required type="text" id="valorRecebido" />
					</div>
					<br>
					<div>
						<label for="dataDividendo">Data da movimentação:</label>
						<input type="date" id="dataDividendo" />
					</div>
					<br>
					<div class="button">
						<button type="submit">Submeter provento</button>
					</div>
				</form>
			</td>
			</tr>
		</tbody>
	</table>
	<br>
	<br>


	<h2>Carteira de investimentos:</h2>
	<table>
		<thead>
			<tr>
				<th>Ação</th>
				<th>Qtd. Ações</th>
				<th>Valor Investido (R$)</th>
				<th>Valor Atual (R$)</th>
				<th>Valor Proventos (R$)</th>
				<th>Preço Médio (R$)</th>
				<th>ROI (%)</th>
				<th>Perc. Carteira (%)</th>
			</tr>
		</thead>
		<tbody>
			<tr th:each="acao : ${acoesDaCarteira.carteiraAcoes}">
				<td th:text="${acao.acao}"></td>
				<td th:text="${acao.qtdAcoes}"></td>
				<td th:text="${acao.valorInvestido}"></td>
				<td th:text="${acao.valorAtual}"></td>
				<td th:text="${acao.valorProventos}"></td>
				<td th:text="${acao.precoMedio}"></td>
				<td th:text="${acao.ROI}"></td>
				<td th:text="${acao.percCarteira}"></td>
			</tr>
			<tr>
				<td >TOTAL</td>
				<td >-</td>
				<td th:text="${acoesDaCarteira.valorInvestido}"></td>
				<td th:text="${acoesDaCarteira.valorAtual}"></td>
				<td th:text="${acoesDaCarteira.valorProventos}"></td>
				<td >-</td>
				<td th:text="${acoesDaCarteira.ROI}"></td>
				<td >100%</td>
			</tr>
			<!--
			<tr>
				<td>0</td>
				<td>0</td>
				<td>0</td>
				<td>0</td>
				<td>0</td>
				<td>0</td>
				<td>0</td>
				<td>0</td>
			</tr>
			-->
		</tbody>
	</table>


</body>

</html>